# Configuration for YOLOv11n + VideoMAE-Base + SQA (Cross) Adapter
# Best AVA result: 22.63% mAP (CrossAttention fusion)
# Best UCF result: 91.43% mAP (Simple fusion)

# ==================== Dataset Settings ====================
dataset: "ava"
data_root: "data/AVA_Dataset"
num_classes: 80  # AVA=80, UCF=24

# ==================== Model Architecture ====================
# 2D Backbone
backbone2D: "yolov11_n"

# 3D Backbone - VideoMAE with SQA (Cross) adapter
backbone3D: "videomae"

BACKBONE3D:
  TYPE: "videomae"
  VARIANT: "base"
  METHOD: "cross"          # SQA adapter (Options: simple, token, cross, hybrid)
  FREEZE: true
  TARGET_CHANNELS: 1024
  TARGET_SPATIAL_SIZE: 7
  DROPOUT: 0.2

# Fusion Module (Options: Simple, BSTF, CFAM, SE, CBAM, Channel, Spatial, LKA, MultiHead)
fusion_module: "CrossAttention"

# Model mode
mode: "decoupled"

# Channel configurations [decoupled, fusion, detection]
interchannels: [256, 256, 256]

# ==================== Training Settings ====================
epochs: 20
batch_size: 12
learning_rate: 0.00015
lr: 0.00015
optimizer_type: "adamw"
weight_decay: 0.0005

# Gradient settings
gradient_clip: 1.0
gradient_accumulation: 2

# Scheduler
scheduler_type: "cosine"
cosine_t_max: 20             # Should match epochs
cosine_eta_min: 1.5e-6
multistep_milestones: null
multistep_gamma: 0.5

# Warmup
use_warmup: true
max_step_warmup: 500

# EMA (Exponential Moving Average)
use_ema: true
ema_decay: 0.999

# Mixed precision
use_fp16: true

# ==================== Pretrained Weights ====================
pretrain_2d: true
pretrain_3d: true
pretrain_path: null          # Set to checkpoint path for fine-tuning

# Freezing strategy
freeze_bb2D: false
freeze_bb3D: true
freeze_videomae: true
unfreeze_epoch: 5            # Unfreeze VideoMAE at epoch 5
videomae_lr_ratio: 0.1       # 0.1x LR for VideoMAE after unfreeze

# ==================== Input Settings ====================
img_size: 224
clip_length: 16
sampling_rate: 1

# ==================== Loss Settings ====================
loss: "tal"
LOSS:
  TAL:
    top_k: 10
    alpha: 1.0
    beta: 6.0
    radius: 2.5
    iou_type: "ciou"
    iou_weight: 2.0
    scale_cls_loss: 0.5
    scale_box_loss: 7.5
    scale_dfl_loss: 1.5
    soft_label: true

# ==================== Hardware Settings ====================
device: "cuda"
num_workers: 8
pin_memory: true

# ==================== Checkpointing ====================
save_dir: "weights/yolov11_videomae"
save_best: true
resume: null

# ==================== Other Settings ====================
active_checker: false
